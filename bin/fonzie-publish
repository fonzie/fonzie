#!/usr/bin/env node

var program   = require('commander');
var registry  = require('../lib/registry');
var utils     = require('../lib/utils');
var path      = require('path');
var manifest  = require(path.resolve('component.json'));

var prompt = {
  confirm: '  Registering a package will add it registry and you cannot edit it. Are you sure? '
};

program
  .parse(process.argv);

console.log();
program.prompt(prompt, function(obj){

  if( !manifest.name ) utils.fatal('component.json must have a name');
  if( !manifest.description ) utils.fatal('component.json must have a description');
  if( !manifest.repo ) utils.fatal('component.json must have a repo');

  if( bool(obj.confirm) === false ) process.exit();

  registry.register(manifest, function(err){
    if (err) utils.fatal(err.message);
    console.log();
    console.log('  \033[36m%s\033[m', 'Package created!');
    console.log();
    process.exit();
  });
});

/**
 * Boolean from `str`.
 */

function bool(str) {
  return /^y(es)?/i.test(str);
}